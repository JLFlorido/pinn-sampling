"""Run PINN to solve Burger's Equation using adaptive resampling (RAD) based on gradient/curvature information. 
Testing interpolator for the forgetting code.


""" 
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Initial imports and some function definitions.
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

from distutils.version import LooseVersion
import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import RegularGridInterpolator

def gen_testdata(): # This function opens the ground truth solution. Need to change path directory for running in ARC.
    data = np.load("./Burgers.npz")
    t, x, exact = data["t"], data["x"], data["usol"].T
    xx, tt = np.meshgrid(x, t)
    X = np.vstack((np.ravel(xx), np.ravel(tt))).T
    y = exact.flatten()[:, None]
    x=np.squeeze(x)
    t=np.squeeze(t)
    exact=np.squeeze(exact)
    itp = RegularGridInterpolator( (t, x), exact, method='linear', bounds_error=False, fill_value=None)
    return X, y, itp

def gen_testdata2(): # This function opens the ground truth solution. Need to change path directory for running in ARC.
    data = np.load("./Burgers.npz")
    t, x, exact = data["t"], data["x"], data["usol"].T
    xx, tt = np.meshgrid(x, t)
    X = np.vstack((np.ravel(xx), np.ravel(tt))).T
    y = exact.flatten()[:, None]
    x=np.squeeze(x)
    t=np.squeeze(t)
    exact=np.squeeze(exact)
    print(x.shape)
    print(t.shape)
    itp = RegularGridInterpolator( (x, t), exact.T, method='linear', bounds_error=False, fill_value=None)
    return X, y, itp


# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Main code start
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

def main(NumResamples=100): # Main Code

    # X_test, y_true, itp = gen_testdata() # Ground Truth Solution. (25600,2) coordinates and corresponding (25600,1) values of u.
    # plt.figure(0)
    # plt.scatter(X_test[:,1],X_test[:,0],c=y_true, cmap='rainbow')
    # for _ in range(NumResamples): # Resampling loop begins. 100 is default, first run took ~4 hours...
        # X_L10 = [[-0.04367683,  0.45388916],
    #         [-0.0379456,   0.53884443],
    #         [-0.38611383,  0.94206052],
    #         [-0.92134607,  0.18048228],
    #         [-0.13201879,  0.07725717],
    #         [-0.24175454,  0.73553567],
    #         [ 0.02495336,  0.95986602],
    #         [-0.15487683,  0.48720058],
    #         [-0.65971625,  0.20773333],
    #         [-0.77465234,  0.00487578],
    #         [-0.13700706,  0.8089111 ],
    #         [ 0.6752311,  0.11929674],
    #         [-0.20599623,  0.98766853],
    #         [-0.14810441,  0.8356577 ],
    #         [-0.16861015,  0.5125572 ],
    #         [-0.71128013,  0.23124589],
    #         [ 0.18412511,  0.77061995],
    #         [-0.16559878,  0.32190046],
    #         [ 0.19410195,  0.68741002],
    #         [-0.09159484,  0.385538  ],
    #         [-0.93571917,  0.13591116],
    #         [-0.61546641,  0.86968228],
    #         [ 0.47436831,  0.23407921],
    #         [-0.06732014,  0.38520956],
    #         [ 0.4283835 ,  0.12556769],
    #         [ 0.49811737,  0.08585144],
    #         [-0.16351048,  0.4908909 ],
    #         [-0.33782236,  0.55850945],
    #         [ 0.90694711,  0.46672193],
    #         [-0.13763243,  0.25039644],
    #         [ 0.76336115,  0.84401485],
    #         [ 0.67462558,  0.77832238],
    #         [-0.83359962,  0.20342076],
    #         [-0.18853294,  0.15903105],
    #         [ 0.32582567,  0.69369187],
    #         [ 0.28504447,  0.56448949],
    #         [-0.18026812,  0.92861595],
    #         [-0.51565326,  0.30130609],
    #         [-0.25289563,  0.33864636],
    #         [-0.73750075,  0.04127638],
    #         [-0.27995173,  0.62232428],
    #         [-0.18468849,  0.40977007],
    #         [ 0.33065281,  0.98488805],
    #         [-0.36993953,  0.85551434],
    #         [-0.13287358,  0.80772433],
    #         [-0.59176071,  0.54934318],
    #         [ 0.27950657,  0.74050172],
    #         [ 0.18471012,  0.24335076],
    #         [ 0.92022619,  0.68978596],
    #         [-0.23620006,  0.10867825],
    #         [-0.16522069,  0.73923139],
    #         [ 0.42197692,  0.82392548],
    #         [ 0.31784587,  0.25812751],
    #         [ 0.07659585,  0.10080771],
    #         [ 0.77646885,  0.81120966],
    #         [-0.08529864,  0.83267955],
    #         [-0.85651847,  0.86256497],
    #         [-0.19531703,  0.47741507],
    #         [-0.41292707,  0.84581138],
    #         [ 0.82070394,  0.84249317],
    #         [-0.1464099 ,  0.83217028],
    #         [-0.17733919,  0.24225048],
    #         [ 0.12038582,  0.43305314],
    #         [-0.31954726,  0.6188679 ],
    #         [-0.93852587,  0.44605544],
    #         [-0.58679379,  0.11389733],
    #         [-0.32405575,  0.59941461],
    #         [-0.5162172 ,  0.53034803],
    #         [ 0.52756146,  0.29310454],
    #         [ 0.51512495,  0.55210903],
    #         [-0.57125086,  0.23335661],
    #         [-0.08808117,  0.09161564],
    #         [-0.09258859,  0.61570797],
    #         [ 0.6920319 ,  0.601429  ],
    #         [ 0.44264587,  0.05024745],
    #         [-0.30245343,  0.9273521 ],
    #         [-0.19163939,  0.42415167],
    #         [-0.25959898,  0.36942031],
    #         [-0.82964559,  0.53689582],
    #         [ 0.7671276 ,  0.43769882],
    #         [ 0.30523016,  0.18697549],
    #         [-0.11101459,  0.01403206],
    #         [-0.11145409,  0.70739806],
    #         [-0.47501068,  0.67455824],
    #         [ 0.79473088,  0.15339204],
    #         [ 0.10271251,  0.30520256],
    #         [-0.37406865,  0.03881248],
    #         [-0.14409087,  0.5013437 ],
    #         [ 0.35725284,  0.11792101],
    #         [ 0.27245054,  0.06145449],
    #         [-0.31679064,  0.22088534],
    #         [-0.68215062,  0.18865739],
    #         [-0.4713001 ,  0.28226496],
    #         [ 0.88507486,  0.15720082],
    #         [-0.11319388,  0.42964719],
    #         [ 0.01676504,  0.15286757],
    #         [-0.1767524 ,  0.10018263],
    #         [-0.68024901,  0.55983754],
    #         [ 0.60695017,  0.9895714 ],
    #         [-0.03155892,  0.3452053 ],
    #         [-0.27683984,  0.52360626],
    #         [-0.09449096,  0.68666964],
    #         [-0.52123831,  0.9861152 ],
    #         [-0.27288484,  0.52291826],
    #         [ 0.42340247,  0.19942586],
    #         [ 0.20368892,  0.95989291],
    #         [-0.48549569,  0.99814579],
    #         [-0.09979426,  0.35308755],
    #         [-0.13069037,  0.43029552],
    #         [ 0.55195112,  0.20489124],
    #         [-0.16480704,  0.85171998],
    #         [ 0.98617196,  0.94829281],
    #         [-0.25049831,  0.48537204],
    #         [-0.25477022,  0.53910167],
    #         [-0.05940046,  0.41577509],
    #         [ 0.15951157,  0.21199095],
    #         [-0.35929814,  0.41320289],
    #         [-0.18807776,  0.61509205],
    #         [ 0.24033939,  0.81407624],
    #         [ 0.21573648,  0.09981097],
    #         [ 0.50334753,  0.54187594],
    #         [ 0.72134504,  0.65924752],
    #         [-0.32173578,  0.63608927],
    #         [-0.68151876,  0.07446859],
    #         [ 0.65884266,  0.12290305],
    #         [-0.12581883,  0.433811  ],
    #         [ 0.24661185,  0.08137769],
    #         [ 0.90661155,  0.11948509],
    #         [ 0.72867982,  0.92068541],
    #         [-0.10356327,  0.46213897],
    #         [-0.27933366,  0.49379837],
    #         [-0.22441061,  0.51878383],
    #         [ 0.69495887,  0.98693144],
    #         [-0.18637659,  0.99024214],
    #         [-0.22722281,  0.50796953],
    #         [-0.47757405,  0.70387338],
    #         [-0.16902267,  0.30321358],
    #         [-0.97291007,  0.76043514],
    #         [-0.10569333,  0.3741478 ],
    #         [-0.10948217,  0.39793959],
    #         [-0.0083043 ,  0.23416084],
    #         [-0.28253253,  0.02726081],
    #         [ 0.04788526,  0.17006136],
    #         [-0.21442484,  0.96984802],
    #         [-0.71533986,  0.08127471],
    #         [ 0.00390608,  0.24392438],
    #         [-0.12376298,  0.40602606],
    #         [ 0.40921995,  0.21385456],
    #         [-0.0525373 ,  0.33514244],
    #         [-0.13414186,  0.82618536],
    #         [-0.09199154,  0.33576252],
    #         [ 0.02554362,  0.15239631],
    #         [ 0.17666805,  0.28175532],
    #         [-0.63708685,  0.36192455],
    #         [-0.18433147,  0.34985907],
    #         [-0.11352564,  0.41200867],
    #         [ 0.1841797 ,  0.27593735],
    #         [ 0.14827181,  0.48057484],
    #         [-0.30280963,  0.62005337],
    #         [-0.75186142,  0.6533611 ],
    #         [-0.32713864,  0.91779033],
    #         [ 0.11467112,  0.11341568],
    #         [-0.11202356,  0.41827967],
    #         [-0.07514623,  0.33566446],
    #         [ 0.45279799,  0.07477687],
    #         [ 0.37852694,  0.3993536 ],
    #         [ 0.53121517,  0.62355143],
    #         [ 0.76221562,  0.31979726],
    #         [-0.19729836,  0.82017428],
    #         [-0.24401642,  0.59433727],
    #         [-0.70777228,  0.63229568],
    #         [ 0.2165033 ,  0.07990764],
    #         [-0.33155075,  0.62545548],
    #         [ 0.85213709,  0.8922915 ],
    #         [ 0.46365267,  0.11953428],
    #         [ 0.0616837 ,  0.23404658],
    #         [-0.33703389,  0.67903829],
    #         [-0.05799313,  0.3554593 ],
    #         [ 0.14095134,  0.91446355],
    #         [ 0.41397012,  0.08125669],
    #         [-0.85965429,  0.07661659],
    #         [-0.13653758,  0.9780525 ],
    #         [ 0.3726902 ,  0.9842027 ],
    #         [ 0.02149889,  0.00380929],
    #         [ 0.039322  ,  0.01750701],
    #         [ 0.43020117,  0.12350932],
    #         [-0.96168084,  0.53994037],
    #         [-0.14630552,  0.16210445],
    #         [ 0.29238026,  0.33780417],
    #         [ 0.98053392,  0.14370192],
    #         [-0.09223392,  0.62019021],
    #         [-0.90898262,  0.66977707],
    #         [ 0.96328451,  0.91147053],
    #         [-0.88327846,  0.17385387],
    #         [ 0.4686987 ,  0.65503292],
    #         [ 0.46266355,  0.12852827],
    #         [ 0.42601864,  0.17778913],
    #         [-0.88308109,  0.10879367],
    #         [-0.20926899,  0.29401695],
    #         [-0.06541233,  0.44136016]]
    #     X_L10=np.array(X_L10)
    #     X_L10[:, [0,1]] = X_L10[:,[1,0]]
    #     Y_L10 = itp(X_L10)
    #     plt.figure(1)
    #     plt.scatter(X_L10[:,0],X_L10[:,1],c=Y_L10, cmap='rainbow')
    #     plt.show()
    # return

    X_test, y_true, itp = gen_testdata2()
    plt.figure(0)
    plt.scatter(X_test[:,1],X_test[:,0], c=y_true)
    X_L10 = [[-0.04367683,  0.45388916],
        [-0.0379456,   0.53884443],
        [-0.38611383,  0.94206052],
        [-0.92134607,  0.18048228],
        [-0.13201879,  0.07725717],
        [-0.24175454,  0.73553567],
        [ 0.02495336,  0.95986602],
        [-0.15487683,  0.48720058],
        [-0.65971625,  0.20773333],
        [-0.77465234,  0.00487578],
        [-0.13700706,  0.8089111 ],
        [ 0.6752311,  0.11929674],
        [-0.20599623,  0.98766853],
        [-0.14810441,  0.8356577 ],
        [-0.16861015,  0.5125572 ],
        [-0.71128013,  0.23124589],
        [ 0.18412511,  0.77061995],
        [-0.16559878,  0.32190046],
        [ 0.19410195,  0.68741002],
        [-0.09159484,  0.385538  ],
        [-0.93571917,  0.13591116],
        [-0.61546641,  0.86968228],
        [ 0.47436831,  0.23407921],
        [-0.06732014,  0.38520956],
        [ 0.4283835 ,  0.12556769],
        [ 0.49811737,  0.08585144],
        [-0.16351048,  0.4908909 ],
        [-0.33782236,  0.55850945],
        [ 0.90694711,  0.46672193],
        [-0.13763243,  0.25039644],
        [ 0.76336115,  0.84401485],
        [ 0.67462558,  0.77832238],
        [-0.83359962,  0.20342076],
        [-0.18853294,  0.15903105],
        [ 0.32582567,  0.69369187],
        [ 0.28504447,  0.56448949],
        [-0.18026812,  0.92861595],
        [-0.51565326,  0.30130609],
        [-0.25289563,  0.33864636],
        [-0.73750075,  0.04127638],
        [-0.27995173,  0.62232428],
        [-0.18468849,  0.40977007],
        [ 0.33065281,  0.98488805],
        [-0.36993953,  0.85551434],
        [-0.13287358,  0.80772433],
        [-0.59176071,  0.54934318],
        [ 0.27950657,  0.74050172],
        [ 0.18471012,  0.24335076],
        [ 0.92022619,  0.68978596],
        [-0.23620006,  0.10867825],
        [-0.16522069,  0.73923139],
        [ 0.42197692,  0.82392548],
        [ 0.31784587,  0.25812751],
        [ 0.07659585,  0.10080771],
        [ 0.77646885,  0.81120966],
        [-0.08529864,  0.83267955],
        [-0.85651847,  0.86256497],
        [-0.19531703,  0.47741507],
        [-0.41292707,  0.84581138],
        [ 0.82070394,  0.84249317],
        [-0.1464099 ,  0.83217028],
        [-0.17733919,  0.24225048],
        [ 0.12038582,  0.43305314],
        [-0.31954726,  0.6188679 ],
        [-0.93852587,  0.44605544],
        [-0.58679379,  0.11389733],
        [-0.32405575,  0.59941461],
        [-0.5162172 ,  0.53034803],
        [ 0.52756146,  0.29310454],
        [ 0.51512495,  0.55210903],
        [-0.57125086,  0.23335661],
        [-0.08808117,  0.09161564],
        [-0.09258859,  0.61570797],
        [ 0.6920319 ,  0.601429  ],
        [ 0.44264587,  0.05024745],
        [-0.30245343,  0.9273521 ],
        [-0.19163939,  0.42415167],
        [-0.25959898,  0.36942031],
        [-0.82964559,  0.53689582],
        [ 0.7671276 ,  0.43769882],
        [ 0.30523016,  0.18697549],
        [-0.11101459,  0.01403206],
        [-0.11145409,  0.70739806],
        [-0.47501068,  0.67455824],
        [ 0.79473088,  0.15339204],
        [ 0.10271251,  0.30520256],
        [-0.37406865,  0.03881248],
        [-0.14409087,  0.5013437 ],
        [ 0.35725284,  0.11792101],
        [ 0.27245054,  0.06145449],
        [-0.31679064,  0.22088534],
        [-0.68215062,  0.18865739],
        [-0.4713001 ,  0.28226496],
        [ 0.88507486,  0.15720082],
        [-0.11319388,  0.42964719],
        [ 0.01676504,  0.15286757],
        [-0.1767524 ,  0.10018263],
        [-0.68024901,  0.55983754],
        [ 0.60695017,  0.9895714 ],
        [-0.03155892,  0.3452053 ],
        [-0.27683984,  0.52360626],
        [-0.09449096,  0.68666964],
        [-0.52123831,  0.9861152 ],
        [-0.27288484,  0.52291826],
        [ 0.42340247,  0.19942586],
        [ 0.20368892,  0.95989291],
        [-0.48549569,  0.99814579],
        [-0.09979426,  0.35308755],
        [-0.13069037,  0.43029552],
        [ 0.55195112,  0.20489124],
        [-0.16480704,  0.85171998],
        [ 0.98617196,  0.94829281],
        [-0.25049831,  0.48537204],
        [-0.25477022,  0.53910167],
        [-0.05940046,  0.41577509],
        [ 0.15951157,  0.21199095],
        [-0.35929814,  0.41320289],
        [-0.18807776,  0.61509205],
        [ 0.24033939,  0.81407624],
        [ 0.21573648,  0.09981097],
        [ 0.50334753,  0.54187594],
        [ 0.72134504,  0.65924752],
        [-0.32173578,  0.63608927],
        [-0.68151876,  0.07446859],
        [ 0.65884266,  0.12290305],
        [-0.12581883,  0.433811  ],
        [ 0.24661185,  0.08137769],
        [ 0.90661155,  0.11948509],
        [ 0.72867982,  0.92068541],
        [-0.10356327,  0.46213897],
        [-0.27933366,  0.49379837],
        [-0.22441061,  0.51878383],
        [ 0.69495887,  0.98693144],
        [-0.18637659,  0.99024214],
        [-0.22722281,  0.50796953],
        [-0.47757405,  0.70387338],
        [-0.16902267,  0.30321358],
        [-0.97291007,  0.76043514],
        [-0.10569333,  0.3741478 ],
        [-0.10948217,  0.39793959],
        [-0.0083043 ,  0.23416084],
        [-0.28253253,  0.02726081],
        [ 0.04788526,  0.17006136],
        [-0.21442484,  0.96984802],
        [-0.71533986,  0.08127471],
        [ 0.00390608,  0.24392438],
        [-0.12376298,  0.40602606],
        [ 0.40921995,  0.21385456],
        [-0.0525373 ,  0.33514244],
        [-0.13414186,  0.82618536],
        [-0.09199154,  0.33576252],
        [ 0.02554362,  0.15239631],
        [ 0.17666805,  0.28175532],
        [-0.63708685,  0.36192455],
        [-0.18433147,  0.34985907],
        [-0.11352564,  0.41200867],
        [ 0.1841797 ,  0.27593735],
        [ 0.14827181,  0.48057484],
        [-0.30280963,  0.62005337],
        [-0.75186142,  0.6533611 ],
        [-0.32713864,  0.91779033],
        [ 0.11467112,  0.11341568],
        [-0.11202356,  0.41827967],
        [-0.07514623,  0.33566446],
        [ 0.45279799,  0.07477687],
        [ 0.37852694,  0.3993536 ],
        [ 0.53121517,  0.62355143],
        [ 0.76221562,  0.31979726],
        [-0.19729836,  0.82017428],
        [-0.24401642,  0.59433727],
        [-0.70777228,  0.63229568],
        [ 0.2165033 ,  0.07990764],
        [-0.33155075,  0.62545548],
        [ 0.85213709,  0.8922915 ],
        [ 0.46365267,  0.11953428],
        [ 0.0616837 ,  0.23404658],
        [-0.33703389,  0.67903829],
        [-0.05799313,  0.3554593 ],
        [ 0.14095134,  0.91446355],
        [ 0.41397012,  0.08125669],
        [-0.85965429,  0.07661659],
        [-0.13653758,  0.9780525 ],
        [ 0.3726902 ,  0.9842027 ],
        [ 0.02149889,  0.00380929],
        [ 0.039322  ,  0.01750701],
        [ 0.43020117,  0.12350932],
        [-0.96168084,  0.53994037],
        [-0.14630552,  0.16210445],
        [ 0.29238026,  0.33780417],
        [ 0.98053392,  0.14370192],
        [-0.09223392,  0.62019021],
        [-0.90898262,  0.66977707],
        [ 0.96328451,  0.91147053],
        [-0.88327846,  0.17385387],
        [ 0.4686987 ,  0.65503292],
        [ 0.46266355,  0.12852827],
        [ 0.42601864,  0.17778913],
        [-0.88308109,  0.10879367],
        [-0.20926899,  0.29401695],
        [-0.06541233,  0.44136016]]
    X_L10=np.array(X_L10)
    plt.figure(1)
    plt.scatter(X_L10[:,1],X_L10[:,0])
    plt.figure(2)
    Y_L10 = itp(X_L10)
    plt.scatter(X_L10[:,1],X_L10[:,0], c=Y_L10)
    plt.show()
 
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Calling main and saving results
# ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

if __name__ == "__main__":
    main() # Run main, record error history and final accuracy.